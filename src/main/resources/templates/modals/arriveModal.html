<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
</head>
<body>

<!-- 상품도착 등록 모달 Fragment -->
<div th:fragment="arriveModal" class="modal fade" id="arriveModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">상품도착 확인</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="arriveForm">
          <input type="hidden" id="arriveProductId" name="productId">

          <div class="mb-3">
            <label class="form-label">상품명</label>
            <input type="text" class="form-control" id="arriveProductName" readonly>
          </div>

          <div class="mb-3">
            <label class="form-label">도착 날짜</label>
            <input type="date" class="form-control" name="arrivalDate" id="arrivalDate" required>
          </div>

          <div class="mb-3">
            <label class="form-label">상품 상태</label>
            <select class="form-select" name="productCondition" required>
              <option value="">선택하세요</option>
              <option value="excellent">매우 좋음</option>
              <option value="good">좋음</option>
              <option value="normal">보통</option>
              <option value="bad">나쁨</option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label">특이사항 <small class="text-muted">(선택)</small></label>
            <textarea class="form-control" name="notes" rows="3"
                      placeholder="상품 상태나 특이사항을 입력하세요"></textarea>
          </div>

          <button type="button" class="btn btn-primary w-100" onclick="submitArriveInfo()">
            등록하기
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<script th:fragment="arriveScript">
  // 상품도착 모달 열기
  function openArriveModal(productId, productName) {
    document.getElementById('arriveProductId').value = productId;
    document.getElementById('arriveProductName').value = productName;

    // 오늘 날짜를 기본값으로 설정
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('arrivalDate').value = today;

    // 폼 초기화
    document.getElementById('arriveForm').reset();
    document.getElementById('arriveProductId').value = productId;
    document.getElementById('arriveProductName').value = productName;
    document.getElementById('arrivalDate').value = today;

    const modal = new bootstrap.Modal(document.getElementById('arriveModal'));
    modal.show();
  }

  // 상품도착 정보 제출
  function submitArriveInfo() {
    const form = document.getElementById('arriveForm');
    const arrivalDate = form.querySelector('[name="arrivalDate"]').value;
    const condition = form.querySelector('[name="productCondition"]').value;

    // 유효성 검사
    if (!arrivalDate) {
      alert('도착 날짜를 선택해주세요.');
      return;
    }

    if (!condition) {
      alert('상품 상태를 선택해주세요.');
      return;
    }

    const formData = new FormData(form);

    fetch('/api/group-buy/arrival-confirm', {
      method: 'POST',
      body: formData
    })
            .then(response => response.json())
            .then(data => {
              alert('상품도착 정보가 등록되었습니다.');
              bootstrap.Modal.getInstance(document.getElementById('arriveModal')).hide();
              location.reload();
            })
            .catch(error => {
              alert('등록 중 오류가 발생했습니다.');
              console.error(error);
            });
  }
</script>

</body>
</html>